{"version":3,"sources":["ng-rules.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","RulesService","$timeout","ruleFn","watchItems","_loop","watchExpressionList","rItems","rules","angular","isDefined","originName","isArray","source","forEach","item","index","push","watchExpression","currentPrefix","createProp","result","$invalid","$scope","$watch","value","isUndefined","i","len","length","ri","rItemMatchResult","customRules","methodName","apply","concat","params","timeChecker","cancel","checkValid","setRule","ruleName","method","getInitResult","undefined","$eval","extend","$setRule","originRules","copy","_regexCollection2","arguments","_analyzeOriginRules2","propStr","propVal","sp","split","node","spName","indexOf","exec","_regexCollection","_analyzeOriginRules","factory","$inject","Object","defineProperty","required","test","number","email","maxLen","rps_value","replace","analyzeOriginRules","analyzeScope","newRules","ruleStr","np","updateRule","rItem","rsp","splice"],"mappings":"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","file":"ng-rules.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n\n\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\n\tvar _regexCollection = __webpack_require__(1);\n\n\tvar _regexCollection2 = _interopRequireDefault(_regexCollection);\n\n\tvar _analyzeOriginRules = __webpack_require__(2);\n\n\tvar _analyzeOriginRules2 = _interopRequireDefault(_analyzeOriginRules);\n\n\tangular.module('ngRules', []).factory('$rules', RulesService);\n\n\tfunction RulesService($timeout) {\n\t    'ngInject';\n\n\t    function ruleFn() {\n\t        var $scope = undefined,\n\t            originName = undefined,\n\t            rules = undefined,\n\t            originRules = undefined,\n\t            timeChecker = undefined,\n\t            source = undefined,\n\t            result = undefined,\n\t            customRules = angular.copy(_regexCollection2['default']);\n\n\t        if (arguments.length === 2) {\n\t            $scope = arguments[0];\n\t            originRules = arguments[1];\n\t        } else {\n\t            $scope = arguments[0];\n\t            originName = arguments[1];\n\t            originRules = arguments[2];\n\t        }\n\n\t        result = getInitResult();\n\n\t        rules = (0, _analyzeOriginRules2['default'])(originRules, $scope, originName);\n\n\t        watchItems();\n\n\t        return result;\n\n\t        function watchItems() {\n\t            var _loop = function (p) {\n\t                var watchExpressionList = [],\n\n\t                // prefix = '',\n\t                rItems = rules[p];\n\n\t                if (angular.isDefined(originName) && angular.isArray(source)) {\n\n\t                    source.forEach(function (item, index) {\n\t                        watchExpressionList.push([function () {\n\t                            return item[p];\n\t                        }, index]);\n\t                    });\n\n\t                    //namespace(result, originName)\n\t                    //prefix = originName;\n\t                    /*\r\n\t                    \r\n\t                                        if (angular.isArray(source)) {\r\n\t                    \r\n\t                                        }\r\n\t                                        else {\r\n\t                                            watchExpressionList = [[p]];\r\n\t                                        }*/\n\t                } else {\n\t                        watchExpressionList = [[p]];\n\t                    }\n\n\t                watchExpressionList.forEach(function (watchExpression) {\n\n\t                    var currentPrefix = angular.isDefined(watchExpression[1]) ? '[' + watchExpression[1] + '].' : '';\n\n\t                    createProp(result, '' + currentPrefix + p, { $invalid: false });\n\n\t                    $scope.$watch(watchExpression[0], function (value) {\n\t                        if (angular.isUndefined(value)) {\n\t                            return;\n\t                        }\n\n\t                        for (var i = 0, len = rItems.length; i < len; i++) {\n\t                            var ri = rItems[i],\n\t                                rItemMatchResult = customRules[ri.methodName].apply(customRules, [value].concat(ri.params));\n\n\t                            createProp(result, '' + currentPrefix + p + '.$invalid', !rItemMatchResult);\n\n\t                            if (!rItemMatchResult) {\n\t                                break;\n\t                            }\n\t                        }\n\n\t                        timeChecker && $timeout.cancel(timeChecker);\n\t                        timeChecker = $timeout(checkValid, 60);\n\t                    });\n\t                });\n\t            };\n\n\t            for (var p in rules) {\n\t                _loop(p);\n\t            }\n\t        }\n\n\t        function checkValid() {\n\t            for (var p in result) {\n\t                if (p === '$invalid') {\n\t                    continue;\n\t                }\n\n\t                if (result[p].$invalid) {\n\t                    result.$invalid = true;\n\t                    return;\n\t                }\n\t            }\n\n\t            result.$invalid = false;\n\t        }\n\n\t        function setRule(ruleName, method) {\n\t            customRules[ruleName] = method;\n\t        }\n\n\t        function getInitResult() {\n\t            var result = undefined;\n\n\t            if (angular.isDefined(originName) && angular.isArray(source = $scope.$eval(originName))) {\n\t                result = [];\n\t            } else {\n\t                result = {};\n\t            }\n\n\t            angular.extend(result, {\n\t                $invalid: false,\n\t                $setRule: setRule\n\t            });\n\n\t            return result;\n\t        }\n\t    }\n\n\t    function createProp(obj, propStr, propVal) {\n\t        var sp = propStr.split('.');\n\t        var node = obj;\n\n\t        for (var i = 0, len = sp.length; i < len; i++) {\n\t            var spName = sp[i];\n\n\t            if (spName.indexOf('[') !== -1) {\n\t                spName = /[^\\[\\]]+/.exec(spName)[0];\n\t            }\n\n\t            if (angular.isUndefined(node[spName])) {\n\t                node[spName] = {};\n\t            }\n\n\t            if (i === len - 1) {\n\t                node[spName] = propVal;\n\t            } else {\n\t                node = node[spName];\n\t            }\n\t        }\n\t    }\n\n\t    return ruleFn;\n\t}\n\tRulesService.$inject = [\"$timeout\"];\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, '__esModule', {\n\t    value: true\n\t});\n\texports['default'] = {\n\t    'required': function required(value) {\n\t        return !(angular.isUndefined(value) || value === null || /^\\s*$/.test(value));\n\t    },\n\t    'number': function number(value) {\n\t        return (/^-?\\d+(?:\\.\\d+)?$/.test(value)\n\t        );\n\t    },\n\t    'email': function email(value) {\n\t        return (/^(\\w+|\\.+)((-\\w+|\\.+)|(\\.+\\w+))*\\@\\w+((\\.|-)\\w+)*\\.\\w+/.test(value)\n\t        );\n\t    },\n\t    'maxLen': function maxLen(value, len) {\n\t        var rps_value = value.replace(/^\\s+|\\s+$/g, '');\n\t        return rps_value.length <= len;\n\t    }\n\t};\n\tmodule.exports = exports['default'];\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, '__esModule', {\n\t    value: true\n\t});\n\tfunction analyzeOriginRules(originRules, $scope, originName) {\n\t    var analyzeScope = undefined,\n\t        newRules = {};\n\n\t    if (originName) {\n\t        analyzeScope = $scope.$eval(originName);\n\t        if (angular.isArray(analyzeScope)) {\n\t            analyzeScope = analyzeScope[0];\n\t        }\n\t    } else {\n\t        analyzeScope = $scope;\n\t    }\n\n\t    for (var p in originRules) {\n\t        var ruleStr = originRules[p];\n\n\t        if (p === '*') {\n\t            for (var np in analyzeScope) {\n\t                updateRule(newRules, np, ruleStr);\n\t            }\n\t        } else {\n\t            updateRule(newRules, p, ruleStr);\n\t        }\n\t    }\n\n\t    return newRules;\n\t}\n\n\tfunction updateRule(rules, p, ruleStr) {\n\t    var sp = ruleStr.split(/\\s*\\|\\s*/);\n\n\t    if (angular.isUndefined(rules[p])) {\n\t        rules[p] = [];\n\t    }\n\n\t    var rItem = rules[p];\n\n\t    for (var i = 0, len = sp.length; i < len; i++) {\n\t        var rsp = sp[i].split(/\\s*:\\s*/),\n\t            methodName = rsp.splice(0, 1)[0];\n\n\t        rItem.push({\n\t            methodName: methodName,\n\t            params: rsp\n\t        });\n\t    }\n\t}\n\n\texports['default'] = analyzeOriginRules;\n\tmodule.exports = exports['default'];\n\n/***/ }\n/******/ ]);"],"sourceRoot":"/source/"}